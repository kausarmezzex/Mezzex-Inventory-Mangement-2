@model Mezzex_Inventory_Mangement.Models.Supplier


<link href="~/css/Notification.css" rel="stylesheet">
<div id="notification"></div>
<style>
    .selectpicker {
        box-shadow: none !important;
        border: 1px solid #ced4da !important;
        outline: none !important;
        border-radius: 0.25rem;
        height: calc(2.875rem + 2px);
        padding: 0.375rem 0.75rem;
        background-color: #fff;
    }
</style>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card shadow-sm border-0 rounded-4">
                <div class="card-header bg-primary text-white rounded-top-4">
                    <h3 class="card-title text-center mb-0">Edit Supplier</h3>
                </div>
                <div class="card-body bg-light rounded-bottom-4">
                    <form id="editSupplierForm" asp-action="Edit" method="post">
                        <input type="hidden" name="SupplierId" value="@Model.SupplierId" />

                        <!-- Supplier Type -->
                        <div class="mb-4">
                            <label for="SupplierType" class="form-label fw-bold">
                                <i class="bi bi-people me-2"></i> Supplier Type
                            </label>
                            <select id="SupplierType" name="SupplierType" class="form-select form-select-lg" required>
                                @foreach (var type in Mezzex_Inventory_Mangement.Models.Supplier.SupplierTypeOptions)
                                {
                                    if (type == Model.SupplierType)
                                    {
                                        <option value="@type" selected>@type</option>
                                    }
                                    else
                                    {
                                        <option value="@type">@type</option>
                                    }
                                }

                            </select>
                        </div>

                        <!-- Company List -->
                        <div class="mb-4">
                            <label for="CompanyId" class="form-label fw-bold">
                                <i class="bi bi-building me-2"></i> Select Companies
                            </label>
                            <select id="CompanyId" name="selectedCompanyIds" class="form-select selectpicker w-100" multiple data-live-search="true" required>
                                @foreach (var company in ViewBag.Companies)
                                {
                                    if (Model.Companies.Any(c => c.CompanyId == company.CompanyId))
                                    {
                                        <option value="@company.CompanyId" selected>@company.CompanyName</option>
                                    }
                                    else
                                    {
                                        <option value="@company.CompanyId">@company.CompanyName</option>
                                    }
                                }

                            </select>
                        </div>

                        <!-- Supplier Name -->
                        <div class="mb-4">
                            <label for="SupplierName" class="form-label fw-bold">
                                <i class="bi bi-person-square me-2"></i> Supplier Name
                            </label>
                            <input type="text"
                                   id="SupplierName"
                                   name="SupplierName"
                                   class="form-control form-control-lg"
                                   value="@Model.SupplierName"
                                   required
                                   maxlength="100" />
                        </div>

                        <!-- Email Address -->
                        <div class="mb-4">
                            <label for="Email" class="form-label fw-bold">
                                <i class="bi bi-envelope me-2"></i> Email Address
                            </label>
                            <input type="email"
                                   id="Email"
                                   name="Email"
                                   class="form-control form-control-lg"
                                   value="@Model.Email"
                                   required
                                   maxlength="100" />
                        </div>

                        <!-- Phone Number -->
                        <div class="mb-4">
                            <label for="Phone" class="form-label fw-bold">
                                <i class="bi bi-telephone me-2"></i> Phone Number
                            </label>
                            <input type="text"
                                   id="Phone"
                                   name="Phone"
                                   class="form-control form-control-lg"
                                   value="@Model.Phone"
                                   required
                                   maxlength="20" />
                        </div>

                        <!-- Website Name -->
                        <div class="mb-4">
                            <label for="WebsiteName" class="form-label fw-bold">
                                <i class="bi bi-globe me-2"></i> Website
                            </label>
                            <input type="text"
                                   id="WebsiteName"
                                   name="WebsiteName"
                                   class="form-control form-control-lg"
                                   value="@Model.WebsiteName"
                                   maxlength="100" />
                        </div>

                        <!-- Password -->
                        <div class="mb-4">
                            <label for="Password" class="form-label fw-bold">
                                <i class="bi bi-lock me-2"></i> Password
                            </label>
                            <input type="password"
                                   id="Password"
                                   name="Password"
                                   class="form-control form-control-lg"
                                   value="@Model.Password"
                                   required
                                   maxlength="50" />
                        </div>

                        <!-- Account Number -->
                        <div class="mb-4">
                            <label for="AccountNumber" class="form-label fw-bold">
                                <i class="bi bi-credit-card me-2"></i> Account Number
                            </label>
                            <input type="text"
                                   id="AccountNumber"
                                   name="AccountNumber"
                                   class="form-control form-control-lg"
                                   value="@Model.AccountNumber"
                                   maxlength="20" />
                        </div>

                        <!-- Representative Name -->
                        <div class="mb-4">
                            <label for="RepresentativeName" class="form-label fw-bold">
                                <i class="bi bi-person me-2"></i> Representative Name
                            </label>
                            <input type="text"
                                   id="RepresentativeName"
                                   name="RepresentativeName"
                                   class="form-control form-control-lg"
                                   value="@Model.RepresentativeName"
                                   maxlength="100" />
                        </div>

                        <!-- Address -->
                        <div class="mb-4">
                            <label for="Address" class="form-label fw-bold">
                                <i class="bi bi-house-door me-2"></i> Address
                            </label>
                            <textarea id="Address"
                                      name="Address"
                                      class="form-control form-control-lg"
                                      rows="2"
                                      maxlength="200">@Model.Address</textarea>
                        </div>

                        <!-- VAT Cycle -->
                        <div class="mb-4">
                            <label for="VatCycle" class="form-label fw-bold">
                                <i class="bi bi-calendar-check me-2"></i> VAT Cycle
                            </label>
                            <select id="VatCycle" name="VatCycle" class="form-select form-select-lg" required>
                                @foreach (var cycle in Mezzex_Inventory_Mangement.Models.Supplier.VatCycleOptions)
                                {
                                    if (cycle == Model.VatCycle)
                                    {
                                        <option value="@cycle" selected>@cycle</option>
                                    }
                                    else
                                    {
                                        <option value="@cycle">@cycle</option>
                                    }
                                }

                            </select>
                        </div>

                        <!-- Is Active -->
                        <div class="mb-4 form-check">
                            <input type="checkbox"
                                   id="IsActive"
                                   name="IsActive"
                                   class="form-check-input"
                                   value="true"
                                   @(Model.IsActive ==true ? "checked" : "") />
                            <label for="IsActive" class="form-check-label fw-bold">
                                <i class="bi bi-eye me-2"></i> Is Active
                            </label>
                        </div>

                        <!-- Save and Back Buttons -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-between">
                            <button type="submit" class="btn btn-success btn-lg rounded-bottom-4 w-75">
                                <i class="bi bi-save me-2"></i> Save Changes
                            </button>
                            <button type="button" class="btn btn-secondary btn-lg rounded-bottom-4 w-25" onclick="history.back()">
                                <i class="bi bi-arrow-left me-2"></i> Back
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {

    <script>
        $(document).ready(function () {
            $('.selectpicker').selectpicker();
            // Live Character Counter for "SupplierName" field
            $('#SupplierName').on('input', function () {
                let maxLength = 100;
                let remaining = maxLength - $(this).val().length;
                $('#supplierNameCounter').text(remaining + " characters left");
            });

            // Live Character Counter for "Address" field
            $('#Address').on('input', function () {
                let maxLength = 200;
                let remaining = maxLength - $(this).val().length;
                $('#addressCounter').text(remaining + " characters left");
            });

            // Notification handling
            function showNotification(message) {
                const $notification = $('#notification');
                $notification.text(message).addClass('show');

                // Hide notification after 3 seconds
                setTimeout(function () {
                    $notification.addClass('hide');

                    // Fully remove after animation
                    setTimeout(function () {
                        $notification.removeClass('show hide').text('');
                    }, 500);
                }, 3000);
            }

            // Example: Show notification on form submit
            $('#editSupplierForm').on('submit', function (e) {
                e.preventDefault();
                let formData = $(this).serialize();

                $.ajax({
                    url: $(this).attr('action'),
                    method: 'POST',
                    data: formData,
                    beforeSend: function () {
                        $('button[type="submit"]').prop('disabled', true).html('<i class="bi bi-hourglass-split me-2"></i> Updating...');
                    },
                    success: function (response) {
                        // Call notification function
                        showNotification('Supplier updated successfully!');
                    },
                    error: function () {
                        showNotification('Error updating supplier. Please try again!');
                    },
                    complete: function () {
                        $('button[type="submit"]').prop('disabled', false).html('<i class="bi bi-save me-2"></i> Update Supplier');
                    }
                });
            });
        });
    </script>
}
